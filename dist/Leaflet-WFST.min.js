/*! leaflet-wfst 1.2.0-alpha04 2017-08-04 */
!function(a,b,c){"use strict";L.XmlUtil={namespaces:{xlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/",xsd:"http://www.w3.org/2001/XMLSchema",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},xmldoc:(new DOMParser).parseFromString("<root />","text/xml"),setAttributes:function(a,b){for(var c in b)if(null!=b[c]&&b[c].toString){var d=b[c].toString(),e=this.namespaces[c.substring(0,c.indexOf(":"))]||null;a.setAttributeNS(e,c,d)}},evaluate:function(a,b){var c=new DOMParser,d=c.parseFromString(b,"text/xml"),e=new XPathEvaluator,f=e.createNSResolver(d.documentElement);return e.evaluate(a,d,f,XPathResult.ANY_TYPE,null)},createElementNS:function(a,b,c){c=c||{};var d=c.uri;d||(d=this.namespaces[a.substring(0,a.indexOf(":"))]),d||(d=this.namespaces[c.prefix]);var e=d?this.xmldoc.createElementNS(d,a):this.xmldoc.createElement(a);return b&&this.setAttributes(e,b),null!=c.value&&e.appendChild(this.xmldoc.createTextNode(c.value)),e},createTextNode:function(a){return a||0===a?this.xmldoc.createTextNode(a):this.xmldoc.createTextNode("")},getNodeText:function(a){return a?a.innerText||a.textContent||a.text:""},serializeXmlDocumentString:function(a){var c=b.implementation.createDocument("","",null);c.appendChild(a);var d=new XMLSerializer;return d.serializeToString(c)},serializeXmlToString:function(a){var b=new XMLSerializer;return b.serializeToString(a)},parseXml:function(b){if("undefined"!=typeof a.DOMParser)return(new a.DOMParser).parseFromString(b,"text/xml");if("undefined"!=typeof a.ActiveXObject&&new a.ActiveXObject("Microsoft.XMLDOM")){var c=new a.ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(b),c}throw new Error("No XML parser found")},parseOwsExceptionReport:function(a){var b=L.XmlUtil.parseXml(a).documentElement;if(!b||"ows:ExceptionReport"!==b.tagName)return null;for(var c={exceptions:[],message:""},d=b.getElementsByTagNameNS(L.XmlUtil.namespaces.ows,"Exception"),e=0,f=d.length;e<f;e++){for(var g=d[e],h=g.getAttribute("exceptionCode"),i=g.getElementsByTagNameNS(L.XmlUtil.namespaces.ows,"ExceptionText"),j={code:h,text:""},k=0,l=i.length;k<l;k++){var m=i[k],n=m.innerText||m.textContent||m.text;j.text+=n,k<l-1&&(j.text+=". ")}c.message+=j.code+" - "+j.text,e<f-1&&(c.message+=" "),c.exceptions.push(j)}return c}},L.Util.request=function(b){b=L.extend({async:!0,method:"POST",data:"",params:{},headers:{},url:a.location.href,success:function(a){console.log(a)},error:function(a){console.log("Ajax request fail"),console.log(a)},complete:function(){}},b);var c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b.success(c.responseText):b.error(c.responseText),b.complete())};var d=b.url+L.Util.getParamString(b.params,b.url);c.open(b.method,d,b.async);for(var e in b.headers)c.setRequestHeader(e,b.headers[e]);c.send(b.data)},L.Filter={},L.filter=function(a){var b=L.XmlUtil.createElementNS("ogc:Filter");return Array.isArray(a)?a.forEach(function(a){b.appendChild(a.toGml())}):a&&b.appendChild(a.toGml()),b},L.Filter.propertyName=function(a){return L.XmlUtil.createElementNS("ogc:PropertyName",{},{value:a})},L.Filter.literal=function(a){return L.XmlUtil.createElementNS("ogc:Literal",{},{value:a})},L.Filter.element=function(a){return a instanceof Element?a:a.toGml()},L.Filter.propertyElement=function(a){return a instanceof Element?a:a&&"function"==typeof a.toGml?a.toGml():L.Filter.propertyName(a)},L.Filter.literalElement=function(a){return a instanceof Element?a:a&&"function"==typeof a.toGml?a.toGml():L.Filter.literal(a)},L.Filter.Abstract=L.Class.extend({attributes:{},options:{},tagName:null,buildFilterContent:function(){throw"Build filter content is abstract and should be implemented"},toGml:function(){var a=L.XmlUtil.createElementNS(this.tagName,this.attributes,this.options);return this.buildFilterContent(a),a}}),L.Filter.BinarySpatial=L.Filter.Abstract.extend({initialize:function(a,b,c){this.propertyName=a,this.value=b,this.crs=c},buildFilterContent:function(a){return a.appendChild(L.Filter.propertyName(this.propertyName)),"string"==typeof this.value?a.appendChild(L.Filter.propertyName(this.value)):a.appendChild(this.value.toGml(this.crs)),a}}),L.Filter.Equals=L.Filter.BinarySpatial.extend({tagName:"ogc:Equals"}),L.Filter.equals=function(a){return new L.Filter.Equals(a)},L.Filter.Disjoint=L.Filter.BinarySpatial.extend({tagName:"ogc:Disjoint"}),L.Filter.disjoint=function(a){return new L.Filter.Disjoint(a)},L.Filter.Touches=L.Filter.BinarySpatial.extend({tagName:"ogc:Touches"}),L.Filter.touches=function(a){return new L.Filter.Touches(a)},L.Filter.Within=L.Filter.BinarySpatial.extend({tagName:"ogc:Within"}),L.Filter.within=function(a){return new L.Filter.Within(a)},L.Filter.Overlaps=L.Filter.BinarySpatial.extend({tagName:"ogc:Overlaps"}),L.Filter.overlaps=function(a){return new L.Filter.Overlaps(a)},L.Filter.Crosses=L.Filter.BinarySpatial.extend({tagName:"ogc:Crosses"}),L.Filter.crosses=function(a){return new L.Filter.Crosses(a)},L.Filter.Intersects=L.Filter.BinarySpatial.extend({tagName:"ogc:Intersects"}),L.Filter.intersects=function(a){return new L.Filter.Intersects(a)},L.Filter.Contains=L.Filter.BinarySpatial.extend({tagName:"ogc:Contains"}),L.Filter.contains=function(a){return new L.Filter.Contains(a)},L.Filter.DistanceBuffer=L.Filter.Abstract.extend({initialize:function(a,b,c,d,e){this.propertyName=a,this.geomerty=b,this.crs=c,this.distance=d,this.units=e},buildFilterContent:function(a){a.appendChild(L.Filter.propertyName(this.propertyName)),a.appendChild(this.geomerty.toGml(this.crs)),a.appendChild(L.XmlUtil.createElementNS("ogc:Distance",{units:this.units},{value:this.distance}))}}),L.Filter.DWithin=L.Filter.DistanceBuffer.extend({tagName:"ogc:DWithin"}),L.Filter.dwithin=function(a,b,c,d,e){return new L.Filter.DWithin(a,b,c,d,e)},L.Filter.Beyond=L.Filter.DistanceBuffer.extend({tagName:"ogc:Beyond"}),L.Filter.beyond=function(a,b,c,d,e){return new L.Filter.Beyond(a,b,c,d,e)},L.Filter.BBox=L.Filter.Abstract.extend({tagName:"ogc:BBOX",geometryField:null,bbox:null,crs:null,initialize:function(a,b,c){this.bbox=b,this.geometryField=a,this.crs=c},buildFilterContent:function(a){this.geometryField&&a.appendChild(L.Filter.propertyName(this.geometryField)),a.appendChild(this.bbox.toGml(this.crs))}}),L.Filter.bbox=function(a,b,c){return new L.Filter.BBox(a,b,c)},L.Filter.GmlObjectID=L.Filter.Abstract.extend({tagName:"ogc:GmlObjectId",initialize:function(a){this.attributes={"gml:id":a}},buildFilterContent:function(){}}),L.Filter.gmlobjectid=function(a){return new L.Filter.GmlObjectID(a)},L.Filter.BinaryOperator=L.Filter.Abstract.extend({initialize:function(a,b){this.firstValue=a,this.secondValue=b},buildFilterContent:function(a){a.appendChild(L.Filter.propertyElement(this.firstValue)),a.appendChild(L.Filter.literalElement(this.secondValue))}}),L.Filter.Add=L.Filter.BinaryOperator.extend({tagName:"Add"}),L.Filter.add=function(a,b){return new L.Filter.Add(a,b)},L.Filter.Sub=L.Filter.BinaryOperator.extend({tagName:"Sub"}),L.Filter.sub=function(a,b){return new L.Filter.Sub(a,b)},L.Filter.Mul=L.Filter.BinaryOperator.extend({tagName:"Mul"}),L.Filter.mul=function(a,b){return new L.Filter.Mul(a,b)},L.Filter.Div=L.Filter.BinaryOperator.extend({tagName:"Div"}),L.Filter.div=function(a,b){return new L.Filter.Div(a,b)},L.Filter.BinaryComparison=L.Filter.BinaryOperator.extend({attributes:{matchCase:!1},initialize:function(a,b,c){L.Filter.BinaryOperator.prototype.initialize.call(this,a,b),this.attributes.matchCase=!!c}}),L.Filter.EQ=L.Filter.BinaryComparison.extend({tagName:"ogc:PropertyIsEqualTo"}),L.Filter.eq=function(a,b){return new L.Filter.EQ(a,b)},L.Filter.NotEQ=L.Filter.BinaryComparison.extend({tagName:"ogc:PropertyIsNotEqualTo"}),L.Filter.neq=function(a,b){return new L.Filter.NotEQ(a,b)},L.Filter.LT=L.Filter.BinaryComparison.extend({tagName:"ogc:PropertyIsLessThan"}),L.Filter.lt=function(a,b){return new L.Filter.LT(a,b)},L.Filter.GT=L.Filter.BinaryComparison.extend({tagName:"ogc:PropertyIsGreaterThan"}),L.Filter.gt=function(a,b){return new L.Filter.GT(a,b)},L.Filter.LEQ=L.Filter.BinaryComparison.extend({tagName:"ogc:PropertyIsLessThanOrEqualTo"}),L.Filter.leq=function(a,b){return new L.Filter.LEQ(a,b)},L.Filter.GEQ=L.Filter.BinaryComparison.extend({tagName:"ogc:PropertyIsGreaterThanOrEqualTo"}),L.Filter.geq=function(a,b){return new L.Filter.GEQ(a,b)},L.Filter.Like=L.Filter.Abstract.extend({tagName:"ogc:PropertyIsLike",attributes:{wildCard:"*",singleChar:"#",escapeChar:"!",matchCase:!0},initialize:function(a,b,c){this.name=a,this.val=b,this.attributes=L.extend(this.attributes,c||{})},buildFilterContent:function(a){var b=L.Filter.propertyName(this.name),c=L.Filter.literal(this.val);return a.appendChild(b),a.appendChild(c),a}}),L.Filter.like=function(a,b,c){return new L.Filter.Like(a,b,c)},L.Filter.IsNull=L.Filter.Abstract.extend({tagName:"ogc:PropertyIsNull",initialize:function(a){this.propertyName=a},buildFilterContent:function(a){a.appendChild(L.Filter.propertyName(this.propertyName))}}),L.Filter.isnull=function(a){return new L.Filter.IsNull(a)},L.Filter.IsBetween=L.Filter.Abstract.extend({tagName:"ogc:PropertyIsBetween",initialize:function(a,b,c){this.property=a,this.lowerBoundary=b,this.upperBoundary=c},buildFilterContent:function(a){a.appendChild(L.Filter.propertyElement(this.property));var b=L.XmlUtil.createElementNS("ogc:LowerBoundary");b.appendChild(L.Filter.literalElement(this.lowerBoundary)),a.appendChild(b);var c=L.XmlUtil.createElementNS("ogc:UpperBoundary");c.appendChild(L.Filter.literalElement(this.upperBoundary)),a.appendChild(c)}}),L.Filter.isbetween=function(a,b,c){return new L.Filter.IsBetween(a,b,c)},L.Filter.BinaryLogic=L.Filter.Abstract.extend({filters:null,initialize:function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);this.filters=a},buildFilterContent:function(a){this.filters.forEach(function(b){a.appendChild(L.Filter.element(b))})}}),L.Filter.And=L.Filter.BinaryLogic.extend({tagName:"And"}),L.Filter.and=function(){return new(Function.prototype.bind.apply(L.Filter.And,arguments))},L.Filter.Or=L.Filter.BinaryLogic.extend({tagName:"Or"}),L.Filter.or=function(){return new(Function.prototype.bind.apply(L.Filter.Or,arguments))},L.Filter.Not=L.Filter.Abstract.extend({tagName:"Not",initialize:function(a){this.filter=a},buildFilterContent:function(a){a.appendChild(L.Filter.element(this.filter))}}),L.Filter.not=function(a){return new L.Filter.Not(a)},L.Filter.Function=L.Filter.Abstract.extend({tagName:"Function",initialize:function(){var a=arguments[0];this.attributes={name:a};for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);this.expressions=b},buildFilterContent:function(a){var b=this.expressions[0];a.appendChild(L.Filter.propertyElement(b));for(var c=1;c<this.expressions.length;c++){var d=this.expressions[c];a.appendChild(L.Filter.literalElement(d))}}}),L.Filter["function"]=function(){return new(Function.prototype.bind.apply(L.Filter.Function,arguments))},L.Format={},L.Format.Scheme=L.Class.extend({options:{geometryField:"Shape"},initialize:function(a){L.setOptions(this,a)},parse:function(a){for(var c=new L.GML.FeatureType({geometryField:this.options.geometryField}),d=a.getElementsByTagNameNS(L.XmlUtil.namespaces.xsd,"complexType")[0],e=d.getElementsByTagNameNS(L.XmlUtil.namespaces.xsd,"sequence")[0],f=0;f<e.childNodes.length;f++){var g=e.childNodes[f];if(g.nodeType===b.ELEMENT_NODE){var h=g.attributes.name;if(h){var i=g.attributes.name.value;if(i!==this.options.geometryField){var j=g.attributes.type;if(!j){var k=g.getElementsByTagNameNS(L.XmlUtil.namespaces.xsd,"restriction");j=k.attributes.base}if(j){var l=j.value.split(":").pop();c.appendField(i,l)}}}}}return c}}),L.Format.Base=L.Class.extend({defaultOptions:{crs:L.CRS.EPSG3857,coordsToLatLng:function(a){return new L.LatLng(a[1],a[0],a[2])},latLngToCoords:function(a){var b=[a.lng,a.lat];return a.alt!==c&&b.push(a.alt),b},geometryField:"Shape"},initialize:function(a){if(L.setOptions(this,L.extend({},this.defaultOptions,a)),a.crs){var b=a.crs;this.options.coordsToLatLng=function(a){var c=L.point(a[0],a[1]),d=b.projection.unproject(c);return a[2]&&(d.alt=a[2]),d},this.options.latLngToCoords=function(a){var c=L.latLng(a);return b.projection.project(c)}}},setFeatureDescription:function(a){this.namespaceUri=a.attributes.targetNamespace.value;var b=new L.Format.Scheme({geometryField:this.options.geometryField});this.featureType=b.parse(a)}}),L.Format.GeoJSON=L.Format.Base.extend({initialize:function(a){L.Format.Base.prototype.initialize.call(this,a),this.outputFormat="application/json"},responseToLayers:function(a){for(var b=[],c=JSON.parse(a),d=0;d<c.features.length;d++)b.push(this.processFeature(c.features[d]));return b},processFeature:function(a){var b=this.generateLayer(a);return b.feature=a,b},generateLayer:function(a){return L.GeoJSON.geometryToLayer(a,this.options||null)}}),L.GML=L.GML||{},L.GML.ParserContainerMixin={parsers:{},initializeParserContainer:function(){this.parsers={}},appendParser:function(a){this.parsers[a.elementTag]=a},parseElement:function(a,b){var c=this.parsers[a.tagName];if(!c)throw"unknown child element "+a.tagName;return c.parse(a,b)}},L.GML.Element=L.Class.extend({elementTag:"",parse:function(){throw"not implemented parse function in parser for "+this.elementTag}}),L.GML.Geometry=L.GML.Element.extend({statics:{DIM:2},dimensions:function(a){return a.attributes.srsDimension?parseInt(a.attributes.srsDimension.value):L.GML.Geometry.DIM}}),L.GML.Coordinates=L.GML.Element.extend({defaultSeparator:{ds:".",cs:",",ts:" "},initialize:function(){this.elementTag="gml:coordinates"},parse:function(a){var b=this.defaultSeparator.ds;a.attributes.decimal&&(b=a.attributes.decimal.value);var c=this.defaultSeparator.cs;a.attributes.cs&&(c=a.attributes.cs.value);var d=this.defaultSeparator.ts;a.attributes.ts&&(d=a.attributes.ts.value);for(var e=[],f=a.textContent.split(d),g=function(a){return"."!==b&&(a=a.replace(b,".")),parseFloat(a)},h=0;h<f.length;h++)e.push(f[h].split(c).map(g));return 1===e.length?e[0]:e}}),L.GML.Pos=L.GML.Element.extend({initialize:function(){this.elementTag="gml:pos"},parse:function(a){return a.textContent.split(" ").map(function(a){return parseFloat(a)})}}),L.GML.PosList=L.GML.Element.extend({initialize:function(){this.elementTag="gml:posList"},parse:function(a,b){for(var c=[],d=b.dimensions,e=a.textContent.split(" "),f=0;f<e.length;f+=d){for(var g=[],h=f;h<f+d;h++)g.push(parseFloat(e[h]));c.push(g)}return c}}),L.GML.PointNode=L.GML.Geometry.extend({includes:L.GML.ParserContainerMixin,initialize:function(){this.elementTag="gml:Point",this.initializeParserContainer(),this.appendParser(new L.GML.Pos),this.appendParser(new L.GML.Coordinates)},parse:function(a){return this.parseElement(a.firstChild,{dimensions:this.dimensions(a)})}}),L.GML.PointSequence=L.GML.Geometry.extend({includes:L.GML.ParserContainerMixin,initialize:function(){this.initializeParserContainer(),this.appendParser(new L.GML.Pos),this.appendParser(new L.GML.PosList),this.appendParser(new L.GML.Coordinates),this.appendParser(new L.GML.PointNode)},parse:function(a){var b=a.firstChild,c=[],d=b.tagName;if("gml:pos"===d||"gml:Point"===d)for(var e=this.parsers[d],f=a.getElementsByTagNameNS(L.XmlUtil.namespaces.gml,d.split(":").pop()),g=0;g<f.length;g++)c.push(e.parse(f[g]));else c=this.parseElement(b,{dimensions:this.dimensions(a)});return c}}),L.GML.LinearRing=L.GML.PointSequence.extend({initialize:function(){L.GML.PointSequence.prototype.initialize.call(this),this.elementTag="gml:LinearRing"},parse:function(a){var b=L.GML.PointSequence.prototype.parse.call(this,a);return b.pop(),b}}),L.GML.LineStringNode=L.GML.PointSequence.extend({initialize:function(){this.elementTag="gml:LineString",L.GML.PointSequence.prototype.initialize.call(this)},parse:function(a){return L.GML.PointSequence.prototype.parse.call(this,a)}}),L.GML.PolygonNode=L.GML.Geometry.extend({initialize:function(){this.elementTag="gml:Polygon",this.linearRingParser=new L.GML.LinearRing},parse:function(a){for(var c=[],d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];e.nodeType===b.ELEMENT_NODE&&c.push(this.linearRingParser.parse(e.firstChild))}return c}}),L.GML.CoordsToLatLngMixin={transform:function(a,b){if(Array.isArray(a[0])){for(var c=[],d=0;d<a.length;d++)c.push(this.transform(a[d],b));return c}return b.coordsToLatLng(a)}},L.GML.Point=L.GML.PointNode.extend({includes:L.GML.CoordsToLatLngMixin,parse:function(a,b){var c=L.GML.PointNode.prototype.parse.call(this,a),d=new L.Marker;return d.setLatLng(this.transform(c,b)),d}}),L.GML.LineString=L.GML.LineStringNode.extend({includes:L.GML.CoordsToLatLngMixin,parse:function(a,b){var c=new L.Polyline([]),d=L.GML.LineStringNode.prototype.parse.call(this,a);return c.setLatLngs(this.transform(d,b)),c}}),L.GML.Polygon=L.GML.PolygonNode.extend({includes:L.GML.CoordsToLatLngMixin,parse:function(a,b){var c=new L.Polygon([]),d=L.GML.PolygonNode.prototype.parse.call(this,a);return c.setLatLngs(this.transform(d,b)),c}}),L.GML.MultiGeometry=L.GML.Geometry.extend({includes:[L.GML.ParserContainerMixin,L.GML.CoordsToLatLngMixin],initialize:function(){this.initializeParserContainer()},parse:function(a,c){for(var d=[],e=0;e<a.childNodes.length;e++){var f=a.childNodes[e];if(f.nodeType===b.ELEMENT_NODE)for(var g=0;g<f.childNodes.length;g++){var h=f.childNodes[g];h.nodeType===b.ELEMENT_NODE&&d.push(this.parseElement(h,c))}}return this.transform(d,c)}}),L.GML.AbstractMultiPolyline=L.GML.MultiGeometry.extend({initialize:function(){L.GML.MultiGeometry.prototype.initialize.call(this),this.appendParser(new L.GML.LineStringNode)},parse:function(a,b){var c=L.GML.MultiGeometry.prototype.parse.call(this,a,b),d=new L.Polyline([]);return d.setLatLngs(c),d}}),L.GML.AbstractMultiPolygon=L.GML.MultiGeometry.extend({initialize:function(){L.GML.MultiGeometry.prototype.initialize.call(this),this.appendParser(new L.GML.PolygonNode)},parse:function(a,b){var c=L.GML.MultiGeometry.prototype.parse.call(this,a,b),d=new L.Polygon([]);return d.setLatLngs(c),d}}),L.GML.MultiLineString=L.GML.AbstractMultiPolyline.extend({initialize:function(){L.GML.AbstractMultiPolyline.prototype.initialize.call(this),this.elementTag="gml:MultiLineString"}}),L.GML.MultiCurve=L.GML.AbstractMultiPolyline.extend({initialize:function(){L.GML.AbstractMultiPolyline.prototype.initialize.call(this),this.elementTag="gml:MultiCurve"}}),L.GML.MultiPolygon=L.GML.AbstractMultiPolygon.extend({initialize:function(){L.GML.AbstractMultiPolygon.prototype.initialize.call(this),this.elementTag="gml:MultiPolygon"}}),L.GML.MultiSurface=L.GML.AbstractMultiPolygon.extend({initialize:function(){L.GML.AbstractMultiPolygon.prototype.initialize.call(this),this.elementTag="gml:MultiSurface"}}),L.GML.MultiPoint=L.GML.MultiGeometry.extend({initialize:function(){L.GML.MultiGeometry.prototype.initialize.call(this),this.elementTag="gml:MultiPoint",this.appendParser(new L.GML.PointNode)},parse:function(a,b){for(var c=L.GML.MultiGeometry.prototype.parse.call(this,a,b),d=new L.FeatureGroup,e=0;e<c.length;e++){var f=new L.Marker;f.setLatLng(c[e]),d.addLayer(f)}return d}}),L.GML.FeatureType=L.Class.extend({options:{geometryField:"Shape"},primitives:[{types:["byte","decimal","int","integer","long","short"],parse:function(a){return Number(a)}},{types:["string"],parse:function(a){return a}},{types:["boolean"],parse:function(a){return"false"!==a}},{types:["date","time","datetime"],parse:function(a){return new Date(a)}}],initialize:function(a){L.setOptions(this,a),this.fields={}},appendField:function(a,b){var c=this;this.primitives.forEach(function(d){d.types.indexOf(b)!==-1&&(c.fields[a]=d.parse)})},parse:function(a){for(var c={},d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(e.nodeType===b.ELEMENT_NODE){var f=e.tagName.split(":").pop();if(f!==this.options.geometryField){var g=this.fields[f];g||(this.appendField(f,"string"),g=this.fields[f]),c[f]=g(e.textContent)}}}return{type:"Feature",properties:c,id:a.attributes["gml:id"].value}}}),L.Format.GML=L.Format.Base.extend({includes:L.GML.ParserContainerMixin,initialize:function(a){L.Format.Base.prototype.initialize.call(this,a),this.outputFormat="text/xml; subtype=gml/3.1.1",this.initializeParserContainer(),this.appendParser(new L.GML.Point),this.appendParser(new L.GML.LineString),this.appendParser(new L.GML.Polygon),this.appendParser(new L.GML.MultiLineString),this.appendParser(new L.GML.MultiPolygon),this.appendParser(new L.GML.MultiCurve),this.appendParser(new L.GML.MultiSurface),this.appendParser(new L.GML.MultiPoint)},responseToLayers:function(a){for(var c=[],d=L.XmlUtil.parseXml(a),e=d.documentElement,f=e.getElementsByTagNameNS(L.XmlUtil.namespaces.gml,"featureMember"),g=0;g<f.length;g++){var h=f[g].firstChild;c.push(this.processFeature(h))}var i=e.getElementsByTagNameNS(L.XmlUtil.namespaces.gml,"featureMembers");if(i.length>0)for(var j=i[0].childNodes,k=0;k<j.length;k++){var l=j[k];l.nodeType===b.ELEMENT_NODE&&c.push(this.processFeature(l))}return c},processFeature:function(a){var b=this.generateLayer(a);return b.feature=this.featureType.parse(a),b},generateLayer:function(a){var b=a.getElementsByTagNameNS(this.namespaceUri,this.options.geometryField)[0];if(!b)throw new Error("Geometry field '"+this.options.geometryField+"' doesn' exist inside received feature: '"+a.innerHTML+"'");return this.parseElement(b.firstChild,this.options)}}),L.Util.project=function(a,b){if(L.Util.isArray(b)){var c=[];return b.forEach(function(b){c.push(L.Util.project(a,b))}),c}return a.projection.project(b)},L.GmlUtil={posNode:function(a){return L.XmlUtil.createElementNS("gml:pos",{srsDimension:2},{value:a.x+" "+a.y})},posListNode:function(a,b){var c=[];if(a.forEach(function(a){c.push(a.x+" "+a.y)}),b&&a.length>0){var d=a[0];c.push(d.x+" "+d.y)}var e=c.join(" ");return L.XmlUtil.createElementNS("gml:posList",{},{value:e})}},L.CircleMarker.include({toGml:function(a){var b=L.XmlUtil.createElementNS("gml:Point",{srsName:a.code});return b.appendChild(L.GmlUtil.posNode(L.Util.project(a,this.getLatLng()))),b}}),L.LatLngBounds.prototype.toGml=function(a){var b=a.project(this.getSouthWest()),c=a.project(this.getNorthEast()),d=L.XmlUtil.createElementNS("gml:Envelope",{srsName:a.code});return d.appendChild(L.XmlUtil.createElementNS("gml:lowerCorner",{},{value:b.x+" "+b.y})),d.appendChild(L.XmlUtil.createElementNS("gml:upperCorner",{},{value:c.x+" "+c.y})),d},L.Marker.include({toGml:function(a){var b=L.XmlUtil.createElementNS("gml:Point",{srsName:a.code});return b.appendChild(L.GmlUtil.posNode(L.Util.project(a,this.getLatLng()))),b}}),L.Polygon.include({toGml:function(a){for(var b=this.getLatLngs(),c=[],d=0;d<b.length;d++){var e=b[d],f=L.Polyline._flat(e),g=L.XmlUtil.createElementNS("gml:Polygon",{srsName:a.code,srsDimension:2});if(g.appendChild(L.XmlUtil.createElementNS("gml:exterior")).appendChild(L.XmlUtil.createElementNS("gml:LinearRing",{srsDimension:2})).appendChild(L.GmlUtil.posListNode(L.Util.project(a,f?e:e[0]),!0)),!f)for(var h=1;h<e.length;h++)g.appendChild(L.XmlUtil.createElementNS("gml:interior")).appendChild(L.XmlUtil.createElementNS("gml:LinearRing",{srsDimension:2})).appendChild(L.GmlUtil.posListNode(L.Util.project(a,e[h]),!0));c.push(g)}if(1===c.length)return c[0];for(var i=L.XmlUtil.createElementNS("gml:MultiPolygon",{srsName:a.code,srsDimension:2}),j=i.appendChild(L.XmlUtil.createElementNS("gml:polygonMembers")),k=0;k<c.length;k++)j.appendChild(c[k]);return i}}),L.Polyline.include({_lineStringNode:function(a,b){var c=L.XmlUtil.createElementNS("gml:LineString",{srsName:a.code,srsDimension:2});return c.appendChild(L.GmlUtil.posListNode(L.Util.project(a,b),!1)),c},toGml:function(a){var b=this.getLatLngs();if(L.Polyline._flat(b))return this._lineStringNode(a,b);for(var c=L.XmlUtil.createElementNS("gml:MultiLineString",{srsName:a.code,srsDimension:2}),d=c.appendChild(L.XmlUtil.createElementNS("gml:lineStringMembers")),e=0;e<b.length;e++)d.appendChild(this._lineStringNode(a,b[e]));return c}});var d={setProperties:function(a){for(var b in a)a.hasOwnProperty(b)&&(this.feature.properties[b]=a[b])},getProperty:function(a){return this.feature.properties[a]},deleteProperties:function(a){for(var b=0;b<a.length;b++)this.feature.properties.hasOwnProperty(a[b])&&delete this.feature.properties[a[b]]}};L.Marker.include(d),L.Path.include(d),L.WFS=L.FeatureGroup.extend({_capabilities:null,_boundingBox:null,options:{crs:L.CRS.EPSG3857,showExisting:!0,geometryField:"Shape",url:"",version:"1.1.0",typeNS:"",typeName:"",typeNSName:"",maxFeatures:null,filter:null,opacity:1,style:{color:"black",weight:1,opacity:1,fillOpacity:1},namespaceUri:""},state:{},initialize:function(a,b){L.setOptions(this,a),this.state={exist:"exist"},this._layers={},this.readFormat=b||new L.Format.GML({crs:this.options.crs,geometryField:this.options.geometryField}),this.options.typeNSName=this.namespaceName(this.options.typeName),this.options.srsName=this.options.crs.code,this._updateOpacity();var c=this;this.describeFeatureType(function(){c.options.showExisting&&c.loadFeatures(c.options.filter)},function(a){c.fire("error",{error:new Error(a)})})},namespaceName:function(a){return this.options.typeNS+":"+a},describeFeatureType:function(a,b){var c=L.XmlUtil.createElementNS("wfs:DescribeFeatureType",{service:"WFS",version:this.options.version});c.appendChild(L.XmlUtil.createElementNS("TypeName",{},{value:this.options.typeNSName}));var d=this;L.Util.request({url:this.options.url,data:L.XmlUtil.serializeXmlDocumentString(c),headers:this.options.headers||{},success:function(c){var e=L.XmlUtil.parseOwsExceptionReport(c);if(e)return void("function"==typeof b&&b(e.message));var f=L.XmlUtil.parseXml(c),g=f.documentElement;d.readFormat.setFeatureDescription(g),d.options.namespaceUri=g.attributes.targetNamespace.value,"function"==typeof a&&a()},error:function(a){"function"==typeof b&&b(a)}})},getFeature:function(a){var b=L.XmlUtil.createElementNS("wfs:GetFeature",{service:"WFS",version:this.options.version,maxFeatures:this.options.maxFeatures,outputFormat:this.readFormat.outputFormat}),c=b.appendChild(L.XmlUtil.createElementNS("wfs:Query",{typeName:this.options.typeNSName,srsName:this.options.srsName}));return a&&c.appendChild(L.filter(a)),b},loadFeatures:function(a){var b=this;L.Util.request({url:this.options.url,data:L.XmlUtil.serializeXmlDocumentString(b.getFeature(a)),headers:this.options.headers||{},success:function(a){var c=L.XmlUtil.parseOwsExceptionReport(a);if(c)return b.fire("error",{error:new Error(c.message)}),b;var d=b.readFormat.responseToLayers(a,{coordsToLatLng:b.options.coordsToLatLng,pointToLayer:b.options.pointToLayer});return"function"==typeof b.options.style?d.forEach(function(a){a.state=b.state.exist,a.setStyle&&a.setStyle(b.options.style(a)),b.addLayer(a)}):(d.forEach(function(a){a.state=b.state.exist,b.addLayer(a)}),b.setStyle(b.options.style)),b.fire("load",{responseText:a}),b},error:function(a){return b.fire("error",{error:new Error(a)}),b}})},getCapabilities:function(a,b){var c=this._capabilities;if(c&&"function"==typeof a)return void a(c);var d=L.XmlUtil.createElementNS("wfs:GetCapabilities",{service:"WFS",version:this.options.version}),e=this;L.Util.request({url:this.options.url,data:L.XmlUtil.serializeXmlDocumentString(d),headers:this.options.headers||{},success:function(d){var f=L.XmlUtil.parseOwsExceptionReport(d);if(f)return void("function"==typeof b&&b(new Error(f.message)));try{c=L.XmlUtil.parseXml(d).documentElement}catch(g){return void("function"==typeof b&&b(g))}e._capabilities=c,"function"==typeof a&&a(c)},error:function(a){"function"==typeof b&&b(new Error(a))}})},getBoundingBox:function(a,b){var c=this._boundingBox;if(c&&"function"==typeof a)return void a(c);var d=this;this.getCapabilities(function(b){for(var e=b.getElementsByTagName("FeatureTypeList")[0],f=e.getElementsByTagName("FeatureType"),g=0,h=f.length;g<h;g++){var i=f[g],j=L.XmlUtil.getNodeText(i.getElementsByTagName("Name")[0]);if(j===d.options.typeNSName){var k=i.getElementsByTagName("WGS84BoundingBox")[0],l=k.getElementsByTagName("LowerCorner")[0],m=k.getElementsByTagName("UpperCorner")[0],n=L.XmlUtil.getNodeText(l),o=L.XmlUtil.getNodeText(m),p=n.split(" ").reverse(),q=o.split(" ").reverse();c=L.latLngBounds([p,q]);break}}d._boundingBox=c,"function"==typeof a&&a(c)},function(a){"function"==typeof b&&b(new Error(a))})},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this},_updateOpacity:function(){var a=L.extend(this.options.style||{},{opacity:this.options.opacity,fillOpacity:this.options.opacity});this.setStyle(a)}}),L.wfs=function(a,b){return new L.WFS(a,b)},L.WFST=L.WFS.extend({initialize:function(a,b){L.WFS.prototype.initialize.call(this,a,b),this.state=L.extend(this.state,{insert:"insert",update:"update",remove:"remove"}),this.changes={}},addLayer:function(a){if(L.FeatureGroup.prototype.addLayer.call(this,a),a.feature||(a.feature={properties:{}}),!a.state){a.state=this.state.insert;var b=this.getLayerId(a);this.changes[b]=a}return this},removeLayer:function(a){L.FeatureGroup.prototype.removeLayer.call(this,a);var b=this.getLayerId(a);if(b in this.changes){var c=this.changes[b];c.state===this.state.insert?delete this.changes[b]:c.state=this.state.remove}else a.state=this.state.remove,this.changes[b]=a},editLayer:function(a){a.state!==this.state.insert&&(a.state=this.state.update);var b=this.getLayerId(a);return this.changes[b]=a,this},save:function(){var a=L.XmlUtil.createElementNS("wfs:Transaction",{service:"WFS",version:this.options.version}),b=[];for(var c in this.changes){var d=this.changes[c],e=this[d.state](d);a.appendChild(e),d.state===this.state.insert&&b.push(d)}var f=this;return L.Util.request({url:this.options.url,data:L.XmlUtil.serializeXmlDocumentString(a),headers:this.options.headers||{},success:function(a){for(var c=L.XmlUtil.evaluate("//wfs:InsertResults/wfs:Feature/ogc:FeatureId/@fid",a),d=[],e=c.iterateNext();e;)d.push(new L.Filter.GmlObjectId(e)),e=c.iterateNext();b.forEach(function(a){L.FeatureGroup.prototype.removeLayer.call(f,a)}),f.once("load",function(){f.fire("save:success"),f.changes={}}),f.loadFeatures(d)},error:function(a){f.fire("save:failed",a)}}),this}}),L.wfst=function(a,b){return new L.WFST(a,b)},L.WFST.include({gmlFeature:function(a){var b=L.XmlUtil.createElementNS(this.options.typeNSName,{},{uri:this.options.namespaceUri}),c=a.feature;for(var d in c.properties)b.appendChild(this.gmlProperty(d,c.properties[d]));return b.appendChild(this.gmlProperty(this.options.geometryField,a.toGml(this.options.crs))),b},gmlProperty:function(a,b){var c=L.XmlUtil.createElementNS(this.namespaceName(a));return b instanceof Element?c.appendChild(b):c.appendChild(L.XmlUtil.createTextNode(b)),c},wfsProperty:function(a,b){var c=L.XmlUtil.createElementNS("wfs:Property");c.appendChild(L.XmlUtil.createElementNS("wfs:Name",{},{value:a}));var d=L.XmlUtil.createElementNS("wfs:Value");return b instanceof Element?d.appendChild(b):d.appendChild(L.XmlUtil.createTextNode(b)),c.appendChild(d),c}}),L.WFST.include({insert:function(a){var b=L.XmlUtil.createElementNS("wfs:Insert");return b.appendChild(this.gmlFeature(a)),b},update:function(a){var b=L.XmlUtil.createElementNS("wfs:Update",{typeName:this.options.typeNSName}),c=a.feature;for(var d in c.properties)b.appendChild(this.wfsProperty(d,c.properties[d]));b.appendChild(this.wfsProperty(this.namespaceName(this.options.geometryField),a.toGml(this.options.crs)));var e=new L.Filter.GmlObjectID(a.feature.id);return b.appendChild(L.filter(e)),b},remove:function(a){var b=L.XmlUtil.createElementNS("wfs:Delete",{typeName:this.options.typeNSName}),c=new L.Filter.GmlObjectID(a.feature.id);return b.appendChild(L.filter(c)),b}})}(window,document);